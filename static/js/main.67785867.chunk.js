(this.webpackJsonpkta=this.webpackJsonpkta||[]).push([[0],[,,,,,,,function(e,t,n){"use strict";n.r(t),n.d(t,"firebaseInstance",(function(){return r})),n.d(t,"authService",(function(){return a})),n.d(t,"dbService",(function(){return s})),n.d(t,"storageService",(function(){return i}));var c=n(21);n(39),n(41),n(60);c.a.initializeApp({apiKey:"AIzaSyC6I6OeQ0ByUaSJC2Ccsw7zxlbIGVPK0Uc",authDomain:"kta-backend.firebaseapp.com",databaseURL:"https://kta-backend.firebaseio.com",projectId:"kta-backend",storageBucket:"kta-backend.appspot.com",messagingSenderId:"775346930766",appId:"1:775346930766:web:174452c5fa046bd6be6f1f"});var r=c.a,a=c.a.auth(),s=c.a.firestore(),i=c.a.storage()},,,function(e,t,n){"use strict";n.d(t,"c",(function(){return o})),n.d(t,"b",(function(){return d})),n.d(t,"d",(function(){return j})),n.d(t,"a",(function(){return l}));var c=n(23),r=n(6),a=n.n(r),s=n(11),i=n(7),u=n(2),o=function(){var e=Object(s.a)(a.a.mark((function e(t,n){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.dbService.collection("relationship").doc().set({requestorId:t,receiverId:n,requestedAt:Date.now()});case 2:console.log(t);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),d=function(){var e=Object(s.a)(a.a.mark((function e(t,n){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.dbService.collection("relationship").where("requestorId","==",t).where("receiverId","==",n).get();case 2:e.sent.docs[0].ref.delete();case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),j=function(){var e=Object(s.a)(a.a.mark((function e(t){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.dbService.doc("profile/".concat(t.userId)).set(Object(c.a)(Object(c.a)({},t),{},{revisedAt:Date.now()}));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),l=Object(u.createContext)({})},,,,,,,,,function(e,t,n){"use strict";n.d(t,"a",(function(){return u})),n.d(t,"b",(function(){return x})),n.d(t,"c",(function(){return g}));var c=n(4),r=n(7).dbService,a=n(2),s=a.useState,i=a.useEffect,u=function(e,t){var n=s(!1),a=Object(c.a)(n,2),u=a[0],o=a[1],d=s(!1),j=Object(c.a)(d,2),l=j[0],b=j[1];return i((function(){return e===t&&b(!0),r.collection("relationship").where("requestorId","==",e).where("receiverId","==",t).onSnapshot((function(e){o(!e.empty)}))}),[e,t]),[u,l]},o=n(6),d=n.n(o),j=n(11),l=n(1),b=n(28).default,f=n(7).dbService,h=n(2),p=h.useState,O=h.useEffect,x=function(e){var t=p([]),n=Object(c.a)(t,2),r=n[0],a=n[1];return O((function(){e&&function(){var t=Object(j.a)(d.a.mark((function t(){var n,c,r;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,f.collection("relationship").where("requestorId","==",e).get();case 2:return n=t.sent,c=n.docs.map((function(e){return f.doc("profile/".concat(e.data().receiverId)).get()})),t.next=6,Promise.all(c);case 6:r=t.sent,a(r.map((function(e){return Object(l.jsx)(b,{otherData:e.data()},e.data().userId)})));case 8:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()()}),[e]),r},m=n(28),v=n(2).useState,g=function(){var e=v([]),t=Object(c.a)(e,2),n=t[0],r=t[1];return[n,function(e){r(e.map((function(e){return Object(l.jsx)(m.default,{otherData:e.data()},e.data().userId)})))}]}},,,,,,function(e,t,n){"use strict";var c=n(4),r=n(1),a=n(19),s=n(2),i=n(10);n(46);t.a=function(e){var t=e.otherId,n=Object(s.useContext)(i.a),u=Object(a.a)(n.userId,t),o=Object(c.a)(u,2),d=o[0];return o[1]?Object(r.jsx)("button",{className:"friendbutton",children:"it's you!"}):Object(r.jsx)("button",{onClick:function(){d?Object(i.b)(n.userId,t):Object(i.c)(n.userId,t)},className:"friendbutton",children:d?"delete friend":"add friend"})}},,,function(e,t,n){"use strict";n.r(t);var c=n(1),r=(n(2),n(17)),a=n(25);n(47);t.default=function(e){var t=e.otherData;return Object(c.jsxs)("li",{className:"smallprofile",children:[Object(c.jsx)("p",{children:t.userName}),Object(c.jsx)("p",{children:t.unit}),Object(c.jsx)(r.b,{to:"/profile/".concat(t.userId),children:"see profile"}),Object(c.jsx)(a.a,{otherId:t.userId})]})}},,,,,,,,,,,,,,,,,function(e,t,n){},function(e,t,n){},function(e,t,n){},,,,,function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){"use strict";n.r(t);var c=n(1),r=n(2),a=n.n(r),s=n(32),i=n.n(s),u=n(4),o=n(7),d=n(10),j=n(23),l=n(17),b=n(8),f=n(6),h=n.n(f),p=n(11),O=(n(45),function(){var e=new o.firebaseInstance.auth.GoogleAuthProvider,t=function(){var t=Object(p.a)(h.a.mark((function t(){var n,c;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,o.authService.signInWithPopup(e);case 2:return n=t.sent,t.next=5,o.dbService.doc("profile/".concat(n.user.uid)).get();case 5:t.sent.exists||(c={userId:n.user.uid,userName:n.user.displayName,unit:"",armyBranch:""},Object(d.d)(c));case 7:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return Object(c.jsxs)("div",{className:"auth",children:[Object(c.jsx)("p",{children:"Sign in"}),Object(c.jsx)("button",{onClick:t,children:"Google"})]})}),x=n(19),m=(n(52),function(){var e=Object(r.useState)(""),t=Object(u.a)(e,2),n=t[0],a=t[1],s=Object(x.c)(),i=Object(u.a)(s,2),d=i[0],j=i[1],l=function(){var e=Object(p.a)(h.a.mark((function e(t){var c;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.next=3,o.dbService.collection("profile").where("userName","==",n).get();case 3:c=e.sent,j(c.docs);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(c.jsxs)("div",{className:"home",children:[Object(c.jsx)("p",{children:"are you looking for someone?"}),Object(c.jsxs)("form",{onSubmit:l,className:"searchForm",children:[Object(c.jsx)("input",{type:"text",placeholder:"type name here...",onChange:function(e){var t=e.target.value;a(t)}}),Object(c.jsx)("input",{type:"submit",value:"search"})]}),Object(c.jsx)("ul",{className:"usersfoundlist",children:d})]})}),v=(n(53),function(e){var t=e.setIsLoggedIn,n=Object(r.useContext)(d.a),a=Object(b.g)();return Object(c.jsx)("nav",{className:"navigation",children:Object(c.jsxs)("ul",{children:[Object(c.jsx)("li",{children:Object(c.jsx)(l.b,{to:"/",children:"Home"})}),Object(c.jsx)("li",{children:Object(c.jsx)(l.b,{to:"/myprofile",children:null===n||void 0===n?void 0:n.userName})}),Object(c.jsx)("li",{children:Object(c.jsx)(l.b,{to:"/openchat",children:"Openchat"})}),Object(c.jsx)("li",{children:Object(c.jsx)("button",{onClick:function(){o.authService.signOut(),t(!1),a.push("/")},children:"Sign out"})})]})})}),g=function(){var e=Object(r.useContext)(d.a),t=Object(r.useState)(e.userName),n=Object(u.a)(t,2),a=n[0],s=n[1],i=Object(r.useState)(e.unit),o=Object(u.a)(i,2),j=o[0],l=o[1],b=Object(r.useState)(e.branch),f=Object(u.a)(b,2),O=f[0],x=f[1],m=function(e){var t=e.target,n=t.name,c=t.value;"name"===n?s(c):"unit"===n?l(c):"branch"===n&&x(c)},v=function(){var t=Object(p.a)(h.a.mark((function t(n){var c;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n.preventDefault(),c={userId:e.userId,userName:a,unit:j,branch:O},Object(d.d)(c);case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return Object(c.jsxs)("form",{onSubmit:v,children:[Object(c.jsx)("input",{type:"text",name:"name",placeholder:"name",value:a,onChange:m}),Object(c.jsx)("input",{type:"text",placeholder:"unit that you belong to",name:"unit",value:j||"",onChange:m}),Object(c.jsx)("input",{type:"text",placeholder:"branch",name:"branch",value:O||"",onChange:m}),Object(c.jsx)("input",{type:"submit",value:"update profile"})]})},S=(n(54),function(){var e=Object(r.useContext)(d.a),t=Object(x.b)(e.userId);return Object(c.jsxs)("div",{className:"myprofile",children:[Object(c.jsx)("p",{children:"my profile"}),Object(c.jsx)(g,{}),Object(c.jsx)("p",{children:"friends"}),Object(c.jsx)("ul",{className:"friendslist",children:t})]})}),I=n(25),y=(n(55),function(e){var t=e.match,n=Object(r.useState)(null),a=Object(u.a)(n,2),s=a[0],i=a[1];Object(r.useEffect)((function(){(function(){var e=Object(p.a)(h.a.mark((function e(){var n,c;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.dbService.doc("profile/".concat(t.params.userId)).get();case 2:n=e.sent,c=n.data(),i(c);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}),[t]);var d=Object(x.b)(null===s||void 0===s?void 0:s.userId);return Object(c.jsxs)("div",{className:"otherprofile",children:[Object(c.jsxs)("p",{children:[null===s||void 0===s?void 0:s.userName,"'s profile"]}),Object(c.jsxs)("p",{children:["unit : ",null===s||void 0===s?void 0:s.unit]}),Object(c.jsx)("p",{children:"list of friends"}),s?Object(c.jsx)("ul",{className:"friendslist",children:d}):Object(c.jsx)("p",{children:"loading"}),s&&Object(c.jsx)(I.a,{otherId:s.userId})]})}),N=function(){return Object(c.jsxs)(c.Fragment,{children:[Object(c.jsx)("h1",{children:"Page Not Found"}),Object(c.jsx)(l.b,{to:"/",children:"home"})]})},w=(n(56),function(){return Object(c.jsxs)("div",{className:"footer",children:[Object(c.jsx)("p",{children:"SGT Park"}),Object(c.jsxs)("p",{children:["Do you have any ideas for kta? Go to"," ",Object(c.jsx)("a",{href:"https://github.com/ParkChangSun/kta",children:"Github"})]})]})}),k=(n(57),function(){var e=Object(r.useContext)(d.a),t=Object(r.useState)(""),n=Object(u.a)(t,2),a=n[0],s=n[1],i=Object(r.useState)([]),j=Object(u.a)(i,2),l=j[0],b=j[1],f=Object(r.useState)({}),O=Object(u.a)(f,2),x=O[0],m=O[1],v=function(){var t=Object(p.a)(h.a.mark((function t(n){return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n.preventDefault(),t.next=3,o.dbService.collection("chat").doc().set({dateString:(new Date).toLocaleString(),timestamp:Date.now(),userId:e.userId,userName:e.userName,data:a});case 3:s("");case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),g=function(e){return e.map((function(e){return Object(c.jsxs)("li",{className:"chatmessage",children:[Object(c.jsx)("p",{className:"meta",children:e.data().dateString}),Object(c.jsxs)("p",{className:"meta",children:[e.data().userName,"'s message"]}),Object(c.jsx)("p",{className:"data",children:e.data().data})]},e.data().timestamp)}))};return Object(r.useEffect)((function(){o.dbService.collection("chat").orderBy("timestamp","asc").limitToLast(15).get().then((function(e){m(e.docs[0]),b(g(e.docs));var t=document.querySelector(".chatlist");t.scrollTop=t.scrollHeight-t.clientHeight}))}),[]),Object(r.useEffect)((function(){return o.dbService.collection("chat").orderBy("timestamp","asc").onSnapshot((function(e){var t=e.docs.pop();b((function(e){var n=Object(c.jsxs)("li",{className:"chatmessage",children:[Object(c.jsx)("p",{className:"meta",children:t.data().dateString}),Object(c.jsxs)("p",{className:"meta",children:[t.data().userName,"'s message"]}),Object(c.jsx)("p",{className:"data",children:t.data().data})]},t.data().timestamp);return e.concat([n])}))}))}),[]),Object(c.jsxs)("div",{className:"openchat",children:[Object(c.jsx)("ul",{className:"chatlist",onScroll:function(e){0===e.target.scrollTop&&o.dbService.collection("chat").orderBy("timestamp","asc").endBefore(x).limitToLast(5).get().then((function(e){e.docs[0]&&(m(e.docs[0]),b((function(t){var n=document.querySelector(".chatlist");return n.scrollTop=n.scrollTop+10,g(e.docs).concat(t)})))}))},children:l}),Object(c.jsxs)("form",{className:"chatform",onSubmit:v,children:[Object(c.jsx)("input",{type:"text",value:a,onChange:function(e){var t=e.target.value;s(t)},placeholder:"enter message here...",className:"chatinput"}),Object(c.jsx)("input",{type:"submit",value:"chat"})]})]})}),C=function(e){var t=e.isLoggedIn,n=e.setIsLoggedIn;return Object(c.jsxs)(l.a,{basename:"/kta",children:[t&&Object(c.jsx)(v,{setIsLoggedIn:n}),t?Object(c.jsxs)(b.d,{children:[Object(c.jsx)(b.b,{exact:!0,path:"/",children:Object(c.jsx)(m,{})}),Object(c.jsx)(b.b,{path:"/myprofile",children:Object(c.jsx)(S,{})}),Object(c.jsx)(b.b,{path:"/profile/:userId",render:function(e){return Object(c.jsx)(y,Object(j.a)({},e))}}),Object(c.jsx)(b.b,{path:"/openchat",children:Object(c.jsx)(k,{})}),Object(c.jsx)(b.b,{component:N})]}):Object(c.jsxs)(b.d,{children:[Object(c.jsx)(b.b,{exact:!0,path:"/",children:Object(c.jsx)(O,{})}),Object(c.jsx)(b.a,{from:"*",to:"/"})]}),Object(c.jsx)(w,{})]})},D=function(){return Object(c.jsx)("p",{children:"Loading..."})};n(58);var L=function(){var e=Object(r.useState)(!1),t=Object(u.a)(e,2),n=t[0],a=t[1],s=Object(r.useState)(null),i=Object(u.a)(s,2),j=i[0],l=i[1],b=Object(r.useState)(!1),f=Object(u.a)(b,2),h=f[0],p=f[1],O=Object(r.useState)(null),x=Object(u.a)(O,2),m=x[0],v=x[1];return Object(r.useEffect)((function(){o.authService.onAuthStateChanged((function(e){e?(v(e.uid),p(!0)):v("")}))}),[]),Object(r.useEffect)((function(){if(""!==m)return o.dbService.doc("profile/".concat(m)).onSnapshot((function(e){l(e.data()),a(!0)}));console.log("userid is null"),a(!0)}),[m]),Object(c.jsx)(d.a.Provider,{value:j,children:n?Object(c.jsx)(C,{isLoggedIn:h,setIsLoggedIn:p}):Object(c.jsx)(D,{})})};i.a.render(Object(c.jsx)(a.a.StrictMode,{children:Object(c.jsx)(L,{})}),document.getElementById("root"))}],[[59,1,2]]]);
//# sourceMappingURL=main.67785867.chunk.js.map