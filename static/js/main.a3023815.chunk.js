(this.webpackJsonpkta=this.webpackJsonpkta||[]).push([[0],{40:function(e,t,n){},41:function(e,t,n){},46:function(e,t,n){},47:function(e,t,n){},48:function(e,t,n){},49:function(e,t,n){},50:function(e,t,n){},51:function(e,t,n){},52:function(e,t,n){"use strict";n.r(t);var r=n(1),c=n(2),a=n.n(c),s=n(26),i=n.n(s),o=n(7),u=n(18);n(34),n(36),n(53);u.a.initializeApp({apiKey:"AIzaSyC6I6OeQ0ByUaSJC2Ccsw7zxlbIGVPK0Uc",authDomain:"kta-backend.firebaseapp.com",databaseURL:"https://kta-backend.firebaseio.com",projectId:"kta-backend",storageBucket:"kta-backend.appspot.com",messagingSenderId:"775346930766",appId:"1:775346930766:web:174452c5fa046bd6be6f1f"});var j=u.a,l=u.a.auth(),d=u.a.firestore(),b=(u.a.storage(),n(6)),f=n.n(b),p=n(10),h=n(15),O=(n(40),function(e){var t=e.otherId,n=Object(c.useContext)(C),a=w(n.userId,t),s=Object(o.a)(a,2),i=s[0];return s[1]?Object(r.jsx)("button",{className:"friendbutton",children:"it's you!"}):Object(r.jsx)("button",{onClick:function(){i?N(n.userId,t):y(n.userId,t)},className:"friendbutton",children:i?"delete friend":"add friend"})}),x=(n(41),function(e){var t=e.otherData;return Object(r.jsxs)("li",{className:"smallprofile",children:[Object(r.jsx)("p",{children:t.userName}),Object(r.jsx)("p",{children:t.unit}),Object(r.jsx)(h.b,{to:"/profile/".concat(t.userId),children:"see profile"}),Object(r.jsx)(O,{otherId:t.userId})]})}),v=n(2),m=v.useState,g=v.useEffect,I=v.createContext,w=function(e,t){var n=m(!1),r=Object(o.a)(n,2),c=r[0],a=r[1],s=m(!1),i=Object(o.a)(s,2),u=i[0],j=i[1];return g((function(){return e===t&&j(!0),d.collection("relationship").where("requestorId","==",e).where("receiverId","==",t).onSnapshot((function(e){a(!e.empty)}))}),[e,t]),[c,u]},k=function(e){var t=m([]),n=Object(o.a)(t,2),c=n[0],a=n[1];return g((function(){e&&function(){var t=Object(p.a)(f.a.mark((function t(){var n,c,s;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,d.collection("relationship").where("requestorId","==",e).get();case 2:return n=t.sent,c=n.docs.map((function(e){return d.doc("profile/".concat(e.data().receiverId)).get()})),t.next=6,Promise.all(c);case 6:s=t.sent,a(s.map((function(e){return Object(r.jsx)(x,{otherData:e.data()},e.data().userId)})));case 8:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()()}),[e]),c},y=function(){var e=Object(p.a)(f.a.mark((function e(t,n){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.collection("relationship").doc().set({requestorId:t,receiverId:n,requestedAt:Date.now()});case 2:console.log(t);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),N=function(){var e=Object(p.a)(f.a.mark((function e(t,n){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.collection("relationship").where("requestorId","==",t).where("receiverId","==",n).get();case 2:e.sent.docs[0].ref.delete();case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),S=function(){var e=Object(p.a)(f.a.mark((function e(t,n,r){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.collection("profile").doc(t).set({userId:t,userName:n,unit:r,revisedAt:Date.now()});case 2:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),C=I({}),D=n(28),P=n(5),A=(n(46),function(){var e=new j.auth.GoogleAuthProvider,t=function(){var t=Object(p.a)(f.a.mark((function t(){var n,r;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,l.signInWithPopup(e);case 2:return n=t.sent,r=d.doc("profile/".concat(n.user.uid)),t.next=6,r.get();case 6:t.sent.exists||r.set({userId:n.user.uid,userName:n.user.displayName,unit:"",revisedAt:Date.now()});case 8:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return Object(r.jsxs)("div",{className:"auth",children:[Object(r.jsx)("p",{children:"Sign in"}),Object(r.jsx)("button",{onClick:t,children:"Google"})]})}),L=(n(47),function(){var e=Object(c.useState)(""),t=Object(o.a)(e,2),n=t[0],a=t[1],s=function(){var e=m([]),t=Object(o.a)(e,2),n=t[0],c=t[1];return[n,function(e){c(e.map((function(e){return Object(r.jsx)(x,{otherData:e.data()},e.data().userId)})))}]}(),i=Object(o.a)(s,2),u=i[0],j=i[1],l=function(){var e=Object(p.a)(f.a.mark((function e(t){var r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.next=3,d.collection("profile").where("userName","==",n).get();case 3:r=e.sent,j(r.docs);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(r.jsxs)("div",{className:"home",children:[Object(r.jsx)("p",{children:"are you looking for someone?"}),Object(r.jsxs)("form",{onSubmit:l,className:"searchForm",children:[Object(r.jsx)("input",{type:"text",placeholder:"type name here...",onChange:function(e){var t=e.target.value;a(t)}}),Object(r.jsx)("input",{type:"submit",value:"search"})]}),Object(r.jsx)("ul",{className:"usersfoundlist",children:u})]})}),E=(n(48),function(e){var t=e.setIsLoggedIn,n=Object(c.useContext)(C),a=Object(P.g)();return Object(r.jsx)("nav",{className:"navigation",children:Object(r.jsxs)("ul",{children:[Object(r.jsx)("li",{children:Object(r.jsx)(h.b,{to:"/",children:"Home"})}),Object(r.jsx)("li",{children:Object(r.jsx)(h.b,{to:"/myprofile",children:null===n||void 0===n?void 0:n.userName})}),Object(r.jsx)("li",{children:Object(r.jsx)("button",{onClick:function(){l.signOut(),t(!1),a.push("/")},children:"Sign out"})})]})})}),q=function(){var e=Object(c.useContext)(C),t=Object(c.useState)(e.userName),n=Object(o.a)(t,2),a=n[0],s=n[1],i=Object(c.useState)(e.unit),u=Object(o.a)(i,2),j=u[0],l=u[1],b=function(e){var t=e.target,n=t.name,r=t.value;"name"===n?s(r):"unit"===n&&l(r)},h=function(){var t=Object(p.a)(f.a.mark((function t(n){return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n.preventDefault(),S(e.userId,e.userName,j);case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return Object(c.useEffect)((function(){return d.doc("profile/".concat(e.userId)).onSnapshot((function(e){var t;l(null===(t=e.data())||void 0===t?void 0:t.unit)}))}),[e]),Object(r.jsxs)("form",{onSubmit:h,children:[Object(r.jsx)("input",{type:"text",name:"name",placeholder:"name",value:a,onChange:b}),Object(r.jsx)("input",{type:"text",placeholder:"unit that you belong to",name:"unit",value:j||"",onChange:b}),Object(r.jsx)("input",{type:"submit",value:"update profile"})]})},G=(n(49),function(){var e=Object(c.useContext)(C),t=k(e.userId);return Object(r.jsxs)("div",{className:"myprofile",children:[Object(r.jsx)("p",{children:"my profile"}),Object(r.jsx)(q,{}),Object(r.jsx)("p",{children:"friends"}),Object(r.jsx)("ul",{className:"friendslist",children:t})]})}),z=(n(50),function(e){var t=e.match,n=Object(c.useState)(null),a=Object(o.a)(n,2),s=a[0],i=a[1];Object(c.useEffect)((function(){(function(){var e=Object(p.a)(f.a.mark((function e(){var n,r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.doc("profile/".concat(t.params.userId)).get();case 2:n=e.sent,r=n.data(),i(r);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}),[t]);var u=k(null===s||void 0===s?void 0:s.userId);return Object(r.jsxs)("div",{className:"otherprofile",children:[Object(r.jsxs)("p",{children:[null===s||void 0===s?void 0:s.userName,"'s profile"]}),Object(r.jsxs)("p",{children:["unit : ",null===s||void 0===s?void 0:s.unit]}),Object(r.jsx)("p",{children:"list of friends"}),s?Object(r.jsx)("ul",{className:"friendslist",children:u}):Object(r.jsx)("p",{children:"loading"}),s&&Object(r.jsx)(O,{otherId:s.userId})]})}),B=function(){return Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)("h1",{children:"Page Not Found"}),Object(r.jsx)(h.b,{to:"/",children:"home"})]})},F=(n(51),function(){return Object(r.jsxs)("div",{className:"footer",children:[Object(r.jsx)("p",{children:"SGT Park"}),Object(r.jsx)("a",{href:"https://github.com/ParkChangSun/kta",children:"Github"})]})}),J=function(e){var t=e.isLoggedIn,n=e.setIsLoggedIn;return Object(r.jsxs)(h.a,{basename:"/kta",children:[t&&Object(r.jsx)(E,{setIsLoggedIn:n}),t?Object(r.jsxs)(P.d,{children:[Object(r.jsx)(P.b,{exact:!0,path:"/",children:Object(r.jsx)(L,{})}),Object(r.jsx)(P.b,{path:"/myprofile",children:Object(r.jsx)(G,{})}),Object(r.jsx)(P.b,{path:"/profile/:userId",render:function(e){return Object(r.jsx)(z,Object(D.a)({},e))}}),Object(r.jsx)(P.b,{component:B})]}):Object(r.jsxs)(P.d,{children:[Object(r.jsx)(P.b,{exact:!0,path:"/",children:Object(r.jsx)(A,{})}),Object(r.jsx)(P.a,{from:"*",to:"/"})]}),Object(r.jsx)(F,{})]})};var U=function(){var e=Object(c.useState)(!1),t=Object(o.a)(e,2),n=t[0],a=t[1],s=Object(c.useState)(null),i=Object(o.a)(s,2),u=i[0],j=i[1],b=Object(c.useState)(!1),f=Object(o.a)(b,2),p=f[0],h=f[1],O=Object(c.useState)(null),x=Object(o.a)(O,2),v=x[0],m=x[1];return Object(c.useEffect)((function(){l.onAuthStateChanged((function(e){e?(m(e.uid),h(!0)):m("")}))}),[]),Object(c.useEffect)((function(){if(""!==v)return d.doc("profile/".concat(v)).onSnapshot((function(e){j(e.data()),a(!0)}));console.log("userid is null"),a(!0)}),[v]),Object(r.jsx)(C.Provider,{value:u,children:n?Object(r.jsx)(J,{isLoggedIn:p,setIsLoggedIn:h}):Object(r.jsx)("h1",{children:"initializing..."})})};i.a.render(Object(r.jsx)(a.a.StrictMode,{children:Object(r.jsx)(U,{})}),document.getElementById("root"))}},[[52,1,2]]]);
//# sourceMappingURL=main.a3023815.chunk.js.map